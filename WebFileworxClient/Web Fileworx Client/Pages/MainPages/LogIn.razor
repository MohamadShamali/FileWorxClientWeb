@inject UsersServices userServices
@inject NavigationManager navManager

@page "/"

<PageTitle>Fileworx Client: Log In</PageTitle>


<div class="flex items-center justify-center">
        <div class="bg-white p-4 rounded-lg shadow-lg mt-56">

        <img class="w-64 mb-3 ml-5" src="images/download.png" alt="download" />

            <div class="mb-2">
                <label class="font-semibold" for="username">Username:</label>
            <input @bind=userName type="text" id="username" maxlength="255" class="border rounded p-2 w-full">
            </div>
            <div class="mb-4">
            <label class="font-semibold" for="password">Password:</label>
            <input @bind=password type="password" id="password" maxlength="255" class="border rounded p-2 w-full">
            </div>
            <div>
            <button @onclick="checkLogInRequest" class="w-full bg-fw-blue hover:bg-fw-blue-hover text-white font-bold py-2 px-4 rounded">
                    Log In
                </button>
            </div>
        </div>
    </div>

@if (showInvalidInfo)
{
    <InvalidInfoWindow OnClose="clearBoxes" />
}

@code{
    private string? userName;
    private string? password;
    private bool showInvalidInfo = false;
    User? loggedInUser;

    protected override void OnInitialized()
    {
        userServices.RefreshUsers();
        base.OnInitialized();
    }

    private void checkLogInRequest()
    {
        User? tryToLogInUser = userServices.CheckLogInInfo(userName, password);

        if (tryToLogInUser != null)
        {
            loggedInUser = tryToLogInUser;
            userServices.loggedInUser = tryToLogInUser;
            navManager.NavigateTo("./f");
        }

        else
        {
            clearBoxes();
            showInvalidInfo = true;
        }
    }

    private void clearBoxes()
    {
        password = string.Empty;
        showInvalidInfo = false;
    }
}